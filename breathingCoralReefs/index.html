<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Dygraph -->
    <script type="text/javascript" src="dygraph.js"></script>
    <link href="dygraph.css" rel="stylesheet">

    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
        integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">

    <!-- stylesheet -->
    <link href="style.css" rel="stylesheet">
    <title>Breathing Coral Reefs</title>

    <!-- Leaflet -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
        integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
        crossorigin="" />

    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
        integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
        crossorigin=""></script>

</head>


<body>
    <div class="coral">
        <div class="col-md-12">
            <h1>Breathing Coral Reefs</h1>
        </div>
    </div>

    <div class="content">
        <div class="main-title">
            <div class="col-md-12">
                <h1>Daily CO<sub>2</sub> Cycles</h1>
            </div>
        </div>

        <!-- Keeps everything aligned with 75% -->
        <div class="mysection">

            <div class="col-md-12">
                <p>Photosynthesis and respiration are key processes in the carbon cycle
                    that can be observed in shallow coral reef environments. This data
                    interactive presents measurements of dissolved inorganic carbon (DIC)
                    and oxygen concentrations in the water column directly above healthy
                    coral reefs. </p>

                <p>The graph below shows variability over several day-night cycles
                    (20 -25 September 2012) in DIC and oxygen concentrations above
                    a shallow coral reef in Palmyra Atoll (<a
                        href="https://link.springer.com/article/10.1007%2Fs00338-014-1217-3" target="_blank">Koweek et
                        al., 2015</a>).
                    What are the predominant trends in the data? What is the relationship
                    between DIC and oxygen concentrations? Based on total alkalinity
                    measurements, calcification and dissolution will also influence DIC
                    concentrations to a lesser extent. Grey shading shows sundown to sunrise.</p>
            </div>


            <!-- Interactive Graph Palmyra-->
            <div class="interactive">
                <div class="row" style="background-color: white;">

                    <div class="col-md-10">
                        <div id="graphdiv1"></div>
                        <p style="color:gray">
                            Drag slider controls left or right to change x axis scale. Drag area between slider controls
                            to
                            pan left or right across plot.
                        </p>
                    </div>

                    <div class="col-md-2">
                        <p>
                            <!-- <b>Display:</b>
                            <br> -->
                            <input id='oxygen' type=checkbox onChange="updateGraph(this, 0)" checked>
                            <label for="oxygen" style="color:#005f73" id="label1"><b>Oxygen</b></label>
                            <br>
                            <input id='DIC' type=checkbox onChange="updateGraph(this, 1)" checked>
                            <label for="DIC" style="color:#ff6361" id="label2"><b>DIC</b></label>
                        </p>
                    </div>
                </div>
            </div> <!-- close interactive -->


            <div class="col-md-12">
                <p>The graph below shows the variability in oxygen concentrations
                    (14-20 November 2011) over a shallow coral reef in Ofu, American
                    Samoa (<a href="https://link.springer.com/article/10.1007/s00338-015-1308-9" target="_blank">Koweek
                        et al., 2015</a>). In addition to photosynthesis and
                    respiration, rising and falling tides will influence water
                    column oxygen concentrations at a given location. </p>
            </div>



            <!--Interactive Graph Ofu -->
            <div class="interactive">
                <div class="row" style="background-color: white;">

                    <div class="col-10">
                        <div id="graphdiv2"></div>
                        <p style="color:gray">
                            Drag slider controls left or right to change x axis scale. Drag area between slider controls
                            to
                            pan left or right across plot.
                        </p>
                    </div>


                    <div class="col-md-2">
                        <p>
                            <!-- <b>Display:</b>
                            <br> -->
                            <input id='oxygen' type=checkbox onChange="updateGraph2(this, 0)" checked>
                            <label for="oxygen" id="label3" style="color:#005f73"><b>Oxygen</b></label>
                        </p>
                    </div>
                </div>
            </div> <!-- close interactive -->

            <!--Leaflet map Palmyra-->
            <div class="col-md-12">
                <p>The location of water sampling in Palmyra
                    is shown below. Zoom in to see closer details of the reef. Zoom out 
                    to see where Palymra is located in relation to the rest of the world. </p>
            </div>

         
            <div class="row">
                <div class="col-md-1"></div>

                <div class="col-md-10">
                    <div id="palmyraMap"></div>
                    <p style="color: grey">Click on the marker for the island name.</p>
                </div>
            </div>

            <!--Leaflet map Ofu -->
            <div class="col-md-12">
                <p>Similarly, the location of water sampling in American Samoa
                    is shown below. </p>
            </div>

            <div class="row">
                <div class="col-md-1"></div>

                <div class="col-md-10">
                    <div id="ofuMap"></div>
                    <p style="color: grey">Click the marker for the island name.</p>
                </div>
            </div>
        </div> <!-- close mysection-->

    </div> <!-- close content-->

</body>


<script type="text/javascript">

    // Leaflet map palmyra
    var mymap = L.map('palmyraMap').setView([5.885, -162.08], 13);// 
    // add tilelayer from MapBox
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 17,
        minZoom: 2,
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
        tileSize: 512,
        zoomOffset: -1
    }).addTo(mymap);

    //Add each marker as a variable
    var palmyra = L.marker([5.87, -162.103]).addTo(mymap);

    // add pop-ups
    palmyra.bindPopup("Palmyra").openPopup();

    // palmyra.on('mouseover', function (e) {
    //     this.openPopup();
    // });
    // palmyra.on('mouseout', function (e) {
    //     this.closePopup();
    // });


    // Leaflet map Ofu
    var mymap2 = L.map('ofuMap').setView([-14.175, -169.645], 13);// 5.885, -162.08

    // add tilelayer from MapBox
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 17,
        minZoom: 2,
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
        tileSize: 512,
        zoomOffset: -1
    }).addTo(mymap2);

    //Add each marker as a variable
    var ofu = L.marker([-14.185, -169.666]).addTo(mymap2);


    // add pop-ups
    ofu.bindPopup("Ofu").openPopup();


    // ofu.on('mouseover', function (e) {
    //     this.openPopup();
    // });
    // ofu.on('mouseout', function (e) {
    //     this.closePopup();
    // });



    //Dygraph for Palymra

    var labelNumber = [
        "label1",
        "label2",
        "label3",
    ]

    chart1 = new Dygraph(
        document.getElementById("graphdiv1"),
        "data/palmyra-averaged.csv", // path to CSV file
        {
            showRangeSelector: true, // zoom bar on the bottom
            labelsSeparateLines: true, // each label on a separate line
            drawPoints: true,
            connectSeparatedPoints: false,
            colors: ['#005f73', '#ff6361'],
            //colors: ['#005f73', '#bb3e03'],
            highlightCircleSize: 6,
            strokeWidth: 1.0,
            digitsAfterDecimal: 0,
            showLabelsOnHighlight: false,
            series: {
                'Oxygen': {
                    axis: 'y1'
                },
                'DIC': {
                    axis: 'y2'
                },
            },


            axes: {
                y: {

                    axisLineColor: '#005f73',
                    axisLineWidth: 2
                    //axisLabelFontSize: 20
                    //axisLabelWidth: 60
                },
                y2: {
                    // set axis-related properties here
                    axisLineColor: '#ff6361',
                    axisLineWidth: 2,
                    axisLabelWidth: 55
                }
            },
            ylabel: 'Oxygen',
            y2label: 'DIC',

            underlayCallback: function (canvas, area, g) {

                function highlight_period(x_start, x_end, myFillStyle) {
                    var bottom_left = g.toDomCoords(x_start, 0);
                    var top_right = g.toDomCoords(x_end, 2500);
                    console.log(bottom_left);
                    console.log(top_right);
                    var left = bottom_left[0];
                    var right = top_right[0];
                    canvas.fillStyle = myFillStyle;
                    canvas.fillRect(left, area.y, right - left, area.h);
                }

                //highlight_period(new Date(2012, 8, 20, 6), new Date(2012, 8, 20, 18), "#fdffb6")
                highlight_period(new Date(2012, 8, 20, 18), new Date(2012, 8, 21, 6), "#efefef") // before rgb(230, 230, 230, 1.0)

                //highlight_period(new Date(2012, 8, 21, 6), new Date(2012, 8, 21, 18), "#fdffb6")
                highlight_period(new Date(2012, 8, 21, 18), new Date(2012, 8, 22, 6), "#efefef")

                //highlight_period(new Date(2012, 8, 22, 6), new Date(2012, 8, 22, 18), "#fdffb6")
                highlight_period(new Date(2012, 8, 22, 18), new Date(2012, 8, 23, 6), "#efefef")

                //highlight_period(new Date(2012, 8, 23, 6), new Date(2012, 8, 23, 18), "#fdffb6")
                highlight_period(new Date(2012, 8, 23, 18), new Date(2012, 8, 24, 6), "#efefef")

                //highlight_period(new Date(2012, 8, 24, 6), new Date(2012, 8, 24, 18), "#fdffb6")
                highlight_period(new Date(2012, 8, 24, 18), new Date(2012, 8, 25, 6), "#efefef")

                //highlight_period(new Date(2012, 8, 25, 6), new Date(2012, 8, 25, 18), "#fdffb6")
                highlight_period(new Date(2012, 8, 25, 18), new Date(2012, 8, 26, 6), "#efefef")
            }
        }
    );

    function updateGraph(el, num) {
        if (el.checked) {     // if checkmark is checked
            chart1.setVisibility(num, true);
            document.getElementById(labelNumber[num]).style.opacity = "1";
        } else {
            chart1.setVisibility(num, false);
            document.getElementById(labelNumber[num]).style.opacity = "0.2";
        }
    }

    // Dygraph for Ofu
    chart2 = new Dygraph(
        document.getElementById("graphdiv2"),
        "data/ofu.csv", // path to CSV file
        {
            showRangeSelector: true, // zoom bar on the bottom
            labelsSeparateLines: true, // each label on a separate line
            drawPoints: true,
            connectSeparatedPoints: false,
            colors: ['#005f73'],
            axes: {
                y: {

                    axisLineColor: '#005f73',
                    axisLineWidth: 2
                    //axisLabelFontSize: 20
                    //axisLabelWidth: 60
                }
            },
            highlightCircleSize: 6,
            strokeWidth: 1.0,
            digitsAfterDecimal: 0,
            showLabelsOnHighlight: false,
            ylabel: "Oxygen",



            underlayCallback: function (canvas, area, g) {

                function highlight_period(x_start, x_end, myFillStyle) {
                    var bottom_left = g.toDomCoords(x_start, 0);
                    var top_right = g.toDomCoords(x_end, 2500);
                    console.log(bottom_left);
                    console.log(top_right);
                    var left = bottom_left[0];
                    var right = top_right[0];
                    canvas.fillStyle = myFillStyle;
                    canvas.fillRect(left, area.y, right - left, area.h);
                }

                //highlight_period(new Date(2011, 10, 14, 6), new Date(2011, 10, 14, 18), "#fdffb6")
                highlight_period(new Date(2011, 10, 14, 18), new Date(2011, 10, 15, 6), "#efefef")

                //highlight_period(new Date(2011, 10, 15, 6), new Date(2011, 10, 15, 18), "#fdffb6")
                highlight_period(new Date(2011, 10, 15, 18), new Date(2011, 10, 16, 6), "#efefef")

                //highlight_period(new Date(2011, 10, 16, 6), new Date(2011, 10, 16, 18), "#fdffb6")
                highlight_period(new Date(2011, 10, 16, 18), new Date(2011, 10, 17, 6), "#efefef")

                //highlight_period(new Date(2011, 10, 17, 6), new Date(2011, 10, 17, 18), "#fdffb6")
                highlight_period(new Date(2011, 10, 17, 18), new Date(2011, 10, 18, 6), "#efefef")

                //highlight_period(new Date(2011, 10, 18, 6), new Date(2011, 10, 18, 18), "#fdffb6")
                highlight_period(new Date(2011, 10, 18, 18), new Date(2011, 10, 19, 6), "#efefef")

                //highlight_period(new Date(2011, 10, 19, 6), new Date(2011, 10, 19, 18), "#fdffb6")
                highlight_period(new Date(2011, 10, 19, 18), new Date(2011, 10, 20, 6), "#efefef")

            }
        }
    );

    function updateGraph2(el, num) {
        if (el.checked) {     // if checkmark is checked
            chart2.setVisibility(num, true);
            document.getElementById("label3").style.opacity = "1";
        } else {
            chart2.setVisibility(num, false);
            document.getElementById("label3").style.opacity = "0.2";
        }
    }


</script>


<!-- Optional JavaScript -->
<!-- jQuery first, then Popper.js, then Bootstrap JS -->
<script src="https://code.jquery.com/jquery-3.4.1.slim.min.js"
    integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n"
    crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
    integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
    crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
    integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
    crossorigin="anonymous"></script>


</html>